# ğŸ‘€ hacking scenario

## description
- [OWASP 2013](https://github.com/gudals-kim/web_vulnerability/blob/delevlop/web/docs/OWASP.md#2013-top-10) ì— ê¸°ìˆ ëœ ì·¨ì•½ì ì„ ë¶„ì„í•©ë‹ˆë‹¤.
- ê°€ì¥ ê¸°ë³¸ì ì¸ í•´í‚¹ë¶€í„° ì‹œë„ í›„ ë¶„ì„í•˜ê³  ìˆ˜ì •í•©ë‹ˆë‹¤.

## ğŸ¥ summary
1. [sql injection](https://github.com/gudals-kim/web_vulnerability/blob/delevlop/web/docs/prototype/scenario.md#1-sql-injection)
2. [parameter ë³€ì¡°](https://github.com/gudals-kim/web_vulnerability/blob/delevlop/web/docs/prototype/scenario.md#2-parameter-%EB%B3%80%EC%A1%B0)
3. [Broken Authentication and Session Management](https://github.com/gudals-kim/web_vulnerability/blob/delevlop/web/docs/prototype/scenario.md#3-broken-authentication-and-session-management)
4. [xxs](https://github.com/gudals-kim/web_vulnerability/blob/delevlop/web/docs/prototype/scenario.md#4-xxs)

---

### 1. sql Injection

#### ê³µê²©

<img src="https://github.com/gudals-kim/web_vulnerability/blob/delevlop/web/docs/prototype/img/sqlinjection.png?raw=true">

#### ê²°ê³¼

> item í…Œì´ë¸”ì´ drop ë˜ì—ˆë‹¤. 

#### ê¸°ì¡´ ì½”ë“œ
```java
public item findDescription(String description)
    String sql = "select * from item where item_description = "+description
    ... 
    ìƒëµ
    ...
```
- ì—¬ê¸°ì„œ descriptionì´ stringìœ¼ë¡œ "; drop table Item if exists cascade;" ìœ¼ë¡œ ë”í•˜ì§€ëŠ” ì—°ì‚°ì´ ë˜ê¸° ë•Œë¬¸ì—
- ì•ì˜ ì¿¼ë¦¬ê°€ ë‚˜ê°€ê³  ê·¸ë‹¤ìŒ ì¿¼ë¦¬ì¸ drop table Item if exists cascade;ê°€ ë‚˜ê°€ì„œ item í…Œì´ë¸”ì´ drop ë˜ì—ˆë‹¤.

#### ìˆ˜ì • ì½”ë“œ
```java
public item findDescription(String description)
    String sql = "select * from item where item_description = ? "
    pstmt.setString(1,description);
    ... 
    ìƒëµ
    ...
```
> ë°”ì¸ë”©ì„ ì´ìš©í•˜ì—¬ sqlì¸ì ì…˜ì˜ ìœ„í—˜ë„ë¥¼ ë‚®ì¶”ì—ˆë‹¤.


---

### 2. parameter ë³€ì¡°

#### ê³µê²©
<img src="https://github.com/gudals-kim/web_vulnerability/blob/delevlop/web/docs/prototype/img/parameter1.png?raw=true">

> ê¸°ì¡´ì— ì´ì¬ìš©ìœ¼ë¡œ ë¡œê·¸ì¸ì„ í–ˆë‹¤. í•˜ì§€ë§Œ ì£¼ì†Œì°½ì˜ memberIdì— í•´ë‹¹í•˜ëŠ” íŒŒë¼ë¯¸í„° 2ë¥¼ 1ë¡œ ë°”ê¾¸ëŠ” ê³µê²©ì„ í–ˆë‹¤.

#### ê²°ê³¼

<img src="https://github.com/gudals-kim/web_vulnerability/blob/delevlop/web/docs/prototype/img/parameter2.png?raw=true">

> memberId 1 ì¸ ì´ë³‘ì² ë¡œ ë°”ë€ŒëŠ” ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆë‹¤.

- url ì˜ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ì— ë‹¤ì–‘í•œ ê°’ì„ ë„£ì—ˆì„ë•Œ ê¶Œí•œì´ ì—†ëŠ” ì‚¬ìš©ìê°€ ë‹¤ì–‘í•œ ì ‘ê·¼ì„ í•  ìˆ˜ ìˆëŠ” ë¬¸ì œê°€ ìƒê²¼ë‹¤.

#### ìˆ˜ì •ì½”ë“œ
```java
@Slf4j
public class LoginCheckInterceptor implements HandlerInterceptor {
    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {

        String requestURI = request.getRequestURI();
        log.info("ì¸ì¦ ì²´í¬ ì¸í„°ì…‰í„° ì‹¤í–‰ {}", requestURI);

        HttpSession session = request.getSession();
        if (session==null || session.getAttribute(LOGIN_MEMBER)==null){
            log.info("ë¯¸ì¸ì¦ ì‚¬ìš©ì ìš”ì²­");
            response.sendRedirect("/login?redirectURL="+requestURI);
            return false;
        }
        return true;
    }
}
```
- spring ì¸í„°ì…‰í„° ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ì—¬ ë¡œê·¸ì¸ì´ ì•ˆëœ ì‚¬ìš©ìëŠ” í™ˆìœ¼ë¡œ ë°”ì¸ë”©ë˜ê²Œ ë§Œë“¤ì—ˆë‹¤.
>  ***userId ë° itemId ë“± ì¤‘ìš” ìƒí’ˆ idëŠ” í•´ì‰¬ë¡œ ì•”í˜¸í™”í•˜ì—¬ íŒŒë¼ë¯¸í„°ì— ì‚¬ìš©í•˜ê²Œ ë°”ê¾¸ì—ˆë‹¤.***



### 3. Broken Authentication and Session Management

#### ê³µê²©

<img src="https://github.com/gudals-kim/web_vulnerability/blob/delevlop/web/docs/prototype/img/cookiesAuthBroken.png?raw=true">

> ë¡œê·¸ì¸ ëœ ê¸°ì¡´ íšŒì›

<img src="https://github.com/gudals-kim/web_vulnerability/blob/delevlop/web/docs/prototype/img/cookiesAuthBroken1.png?raw=true">

> ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ë¥¼ ì´ìš©í•˜ì—¬ ì¿ í‚¤ ë³€ì¡°


#### ê²°ê³¼


<img src="https://github.com/gudals-kim/web_vulnerability/blob/delevlop/web/docs/prototype/img/cookiesAuthBroken2.png?raw=true">

> ë¡œê·¸ì¸ ì •ë³´ê°€ ë°”ë€Œì—ˆë‹¤.

#### ê¸°ì¡´ ì½”ë“œ
```java
    @PostMapping("/login")
    public String login(@Valid @ModelAttribute LoginForm form, BindingResult
    bindingResult, HttpServletResponse response) {
        if (bindingResult.hasErrors()) {
          return "login/loginForm";
        }
        
        Member loginMember = loginService.login(form.getLoginId(),form.getPassword());
        log.info("login? {}", loginMember);
        
        if (loginMember == null) {
          bindingResult.reject("loginFail", "ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ë§ì§€ ì•ŠìŠµë‹ˆë‹¤.");
          return "login/loginForm";
        }
```

- ì·¨ì•½ì  ë¬¸ì œ
  - ì¿ í‚¤ ê°’ì€ ì„ì˜ë¡œ ë³€ê²½í•  ìˆ˜ ìˆë‹¤.
  - ***í´ë¼ì´ì–¸íŠ¸ê°€ ì¿ í‚¤ë¥¼ ê°•ì œë¡œ ë³€ê²½í•˜ë©´ ë‹¤ë¥¸ ì‚¬ìš©ìê°€ ëœë‹¤.***
  - Cookie: memberId=1 Cookie: memberId=2 (ë‹¤ë¥¸ ì‚¬ìš©ìì˜ ì´ë¦„ì´ ë³´ì„) ì¿ í‚¤ì— ë³´ê´€ëœ ì •ë³´ëŠ” í›”ì³ê°ˆ ìˆ˜ ìˆë‹¤.
  - ë§Œì•½ ì¿ í‚¤ì— ê°œì¸ì •ë³´ë‚˜, ì‹ ìš©ì¹´ë“œ ì •ë³´ê°€ ìˆë‹¤ë©´?
  - ì´ ì •ë³´ê°€ ì›¹ ë¸Œë¼ìš°ì €ì—ë„ ë³´ê´€ë˜ê³ , ë„¤íŠ¸ì›Œí¬ ìš”ì²­ë§ˆë‹¤ ê³„ì† í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì„œë²„ë¡œ ì „ë‹¬ëœë‹¤. ì¿ í‚¤ì˜ ì •ë³´ê°€ ë‚˜ì˜ ë¡œì»¬ PCì—ì„œ í„¸ë¦´ ìˆ˜ë„ ìˆê³ , ë„¤íŠ¸ì›Œí¬ ì „ì†¡ êµ¬ê°„ì—ì„œ í„¸ë¦´ ìˆ˜ë„ ìˆë‹¤.
  - í•´ì»¤ê°€ ì¿ í‚¤ë¥¼ í•œë²ˆ í›”ì³ê°€ë©´ í‰ìƒ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
  - í•´ì»¤ê°€ ì¿ í‚¤ë¥¼ í›”ì³ê°€ì„œ ê·¸ ì¿ í‚¤ë¡œ ì•…ì˜ì ì¸ ìš”ì²­ì„ ê³„ì† ì‹œë„í•  ìˆ˜ ìˆë‹¤.


#### ìˆ˜ì • ì½”ë“œ
```java
    @PostMapping("/login")
    public String login(@Valid @ModelAttribute("loginForm") LoginForm loginForm,
                        BindingResult bindingResult,
                        @RequestParam(defaultValue = "/") String redirectURL,
                        HttpServletRequest request){
        if (bindingResult.hasErrors()){
            return "login/loginForm";
        }

        Member loginMember = loginService.login(loginForm.getEmail(), loginForm.getPassword());
        log.debug("loginMember={}",loginMember);
        if (loginMember == null){
            bindingResult.reject("loginFail","ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ë§ì§€ ì•ŠìŠµë‹ˆë‹¤.");
            return "login/loginForm";
        }
        HttpSession session = request.getSession();
        session.setAttribute(LOGIN_MEMBER,loginMember);

        return "redirect:"+redirectURL;
    }
```
- ëŒ€ì•ˆ : ì„¸ì…˜ì„ í™œìš©í–ˆë‹¤.
  - ì¿ í‚¤ì— ì¤‘ìš”í•œ ê°’ì„ ë…¸ì¶œí•˜ì§€ ì•Šê³ , ì‚¬ìš©ì ë³„ë¡œ ì˜ˆì¸¡ ë¶ˆê°€ëŠ¥í•œ ì„ì˜ì˜ í† í°(ëœë¤ ê°’)ì„ ë…¸ì¶œí•˜ê³ , 
  - ì„œë²„ì—ì„œ í† í°ê³¼ ì‚¬ìš©ì idë¥¼ ë§¤í•‘í•´ì„œ ì¸ì‹í•œë‹¤. ê·¸ë¦¬ê³  ì„œë²„ì—ì„œ í† í°ì„ ê´€ë¦¬í•œë‹¤.
  - í† í°ì€ í•´ì»¤ê°€ ì„ì˜ì˜ ê°’ì„ ë„£ì–´ë„ ì°¾ì„ ìˆ˜ ì—†ë„ë¡ ì˜ˆìƒ ë¶ˆê°€ëŠ¥ í•´ì•¼ í•œë‹¤.
  - í•´ì»¤ê°€ í† í°ì„ í„¸ì–´ê°€ë„ ì‹œê°„ì´ ì§€ë‚˜ë©´ ì‚¬ìš©í•  ìˆ˜ ì—†ë„ë¡ ì„œë²„ì—ì„œ í•´ë‹¹ í† í°ì˜ ë§Œë£Œì‹œê°„ì„ ì§§ê²Œ(ì˜ˆ: 30ë¶„) ìœ ì§€í•œë‹¤. 
  - ë˜ëŠ” í•´í‚¹ì´ ì˜ì‹¬ë˜ëŠ” ê²½ìš° ì„œë²„ì—ì„œ í•´ë‹¹ í† í°ì„ ê°•ì œë¡œ ì œê±°í•˜ë©´ ëœë‹¤.

### 4. xxs