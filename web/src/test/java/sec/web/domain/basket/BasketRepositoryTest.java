package sec.web.domain.basket;

import com.zaxxer.hikari.HikariDataSource;
import org.assertj.core.api.Assertions;
import org.junit.jupiter.api.AfterEach;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;
import org.springframework.boot.test.context.SpringBootTest;
import sec.web.domain.item.Item;
import sec.web.domain.member.MemberRepository;

import java.util.List;

import static org.assertj.core.api.Assertions.*;
import static org.junit.jupiter.api.Assertions.*;
import static sec.web.dbconnection.ConnectionConst.*;

@SpringBootTest
class BasketRepositoryTest {
    BasketRepository basketRepository;
    @AfterEach
    void afterEach(){
        basketRepository.reset();
    }
    @BeforeEach
    void beforeEach(){
        HikariDataSource dataSource = new HikariDataSource();
        dataSource.setJdbcUrl(URL);
        dataSource.setUsername(USERNAME);
        dataSource.setPassword(PASSWORD);

        basketRepository = new BasketRepository(dataSource);
    }
    @Test
    @DisplayName("save")
    void save(){
        basketRepository.addBasket(1L,1L);
    }
    @Test
    @DisplayName("장바구니 목록 가져오기 성공")
    void findByMemberId(){
        basketRepository.addBasket(1L,1L);
        basketRepository.addBasket(2L,1L);
        basketRepository.addBasket(3L,1L);
        basketRepository.addBasket(4L,1L);

        List<Item> byMemberId = basketRepository.findByMemberId(1L);
        for (Item item : byMemberId) {
            System.out.println("item = " + item);
        }
    }
    @Test
    @DisplayName("장바구니 목록 가져오기 실패 추가한 장바구니 목록이 없을때")
    void findByMemberId_fail(){

        List<Item> byMemberId = basketRepository.findByMemberId(2L);
        assertThat(byMemberId).isNull();
    }
}