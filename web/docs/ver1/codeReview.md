# ğŸ‘€ code review

## description
- ê¸°ëŠ¥ ë‹¨ìœ„ë¡œ ê¸°ìˆ í•©ë‹ˆë‹¤.
- ì½”ë“œë¥¼ ê°„ë‹¨í•˜ê²Œ ì„¤ëª…í•©ë‹ˆë‹¤.
- html ë° thymeleaf ì½”ë“œëŠ” ìƒëµí•˜ê³  í•´ë‹¹ ë¶€ë¶„ git ë§í¬ë¥¼ ë‚¨ê¹ë‹ˆë‹¤.


## summary
1. íšŒì› ê¸°ëŠ¥
   - íšŒì› ê°€ì…
   - íšŒì› ìˆ˜ì •
   - íšŒì› ì¡°íšŒ
2. ë¡œê·¸ì¸ ê¸°ëŠ¥
   - ì„¸ì…˜/ì¿ í‚¤/ì¸í„°ì…‰í„°
   - ë¡œê·¸ì¸
   - ë¡œê·¸ì•„ì›ƒ
3. ìƒí’ˆ ê¸°ëŠ¥
   - ìƒí’ˆ ë“±ë¡
   - ìƒí’ˆ ìˆ˜ì •
   - ìƒí’ˆ ì‚­ì œ
   - ìƒí’ˆ ì¡°íšŒ(ë‹¨ì¼)
   - ìƒí’ˆ ì¡°íšŒ(ë‚´ê°€ ë“±ë¡í•œ ìƒí’ˆ)
   - ìƒí’ˆ ì¡°íšŒ(ë‚´ê°€ êµ¬ë§¤í•œ ìƒí’ˆ)
4. ì¥ë°”êµ¬ë‹ˆ ê¸°ëŠ¥
   - ì¥ë°”êµ¬ë‹ˆ ì¡°íšŒ
   - ì¥ë°”êµ¬ë‹ˆ ì‚­ì œ
5. ì›¹ ë¨¸ë‹ˆ
   - ìƒí’ˆ êµ¬ë§¤
   - ì›¹ ë¨¸ë‹ˆ ì¶©ì „ 

---

## 1. íšŒì› ê¸°ëŠ¥

### íšŒì› ê°€ì…
#### 1. [html(thymeleaf)](https://github.com/gudals-kim/web_vulnerability/blob/delevlop/web/src/main/resources/templates/member/memberForm.html)

<img src="https://github.com/gudals-kim/web_vulnerability/blob/delevlop/web/docs/img/memberAdd.png">

- íšŒì› ê°€ì… í˜ì´ì§€ ì…ë‹ˆë‹¤.
- url : /members/add


#### 2. ì»¨íŠ¸ë¡¤ëŸ¬ ë¶€ë¶„ (controller)
```java
@Controller
@RequiredArgsConstructor
@RequestMapping("/members")
public class AddMemberController {
    private final MemberRepository memberRepository;

    @GetMapping("/add")
    public String addForm(@ModelAttribute("addMember") AddMemberForm addMember){
        return "member/memberForm";
    }

    @PostMapping("/add")
    public String save(@Valid @ModelAttribute("addMember") AddMemberForm addMember, BindingResult bindingResult){
        Member findMember = memberRepository.find(addMember.getEmail());
        if (findMember != null){
            bindingResult.rejectValue("email","duplicateEmail","ì¤‘ë³µëœ ì´ë©”ì¼ ì…ë‹ˆë‹¤.");
        }
        if (addMember.getConfirmPassword()!=addMember.getPassword()){
            bindingResult.rejectValue("confirmPassword","confirmPassword","ë¹„ë°€ë²ˆí˜¸ê°€ ê°™ì§€ ì•ŠìŠµë‹ˆë‹¤.");
        }
        if (bindingResult.hasErrors()){
            return "member/memberForm";
        }
        Member member = new Member(addMember.getName(),addMember.getEmail(),addMember.getPassword());
        memberRepository.save(member);
        return "redirect:/login";
    }
}
```
- url : /members/add ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤.
- **get ë©”ì„œë“œë¡œ ë“¤ì–´ì˜¤ëŠ” /addì—ì„  addForm ë©”ì„œë“œê°€ ì‹¤í–‰**ë˜ë©°, AddMemberFormì— ì •ì˜ëœ ë°ì´í„° í˜•ì‹ì„ ì‚¬ìš©í•˜ë©° "member/memberForm.html"ë¥¼ ë°˜í™˜í•œë‹¤.
- **post ë©”ì„œë“œë¡œ ë“¤ì–´ì˜¤ëŠ” /addì—ì„  save ë©”ì„œë“œê°€ ì‹¤í–‰**ë˜ë©°, 
  - ì‚¬ìš©ìê°€ ì…ë ¥í•œ ì´ë©”ì¼ì„ ê²€ì¦í•˜ê³  ê²€ì¦ ì‹¤íŒ¨ì‹œ bindingResultì— ë„£ëŠ”ë‹¤.
  - ì‚¬ìš©ìê°€ ì…ë ¥í•œ íŒ¨ìŠ¤ì›Œë“œì™€ íŒ¨ìŠ¤ì›Œë“œ í™•ì¸ì˜ ë°ì´í„°ë¥¼ ê²€ì¦í•˜ê³  ê²€ì¦ ì‹¤íŒ¨ì‹œ bindingResultì— ë„£ëŠ”ë‹¤.
  - bindingResultì— ê°’ì´ ìˆì„ì‹œ ë‹¤ì‹œ member/memberForm.htmlì„ ë¦¬í„´í•œë‹¤.
  - ì •ìƒì ìœ¼ë¡œ íšŒì›ê°€ì…ì´ ì§„í–‰ëœ ê²½ìš° /login url ë¥¼ ë¦¬ë‹¤ì´ë ‰íŠ¸ í•œë‹¤.

#### 3. DBInterface(jdbc)
```java
@Data
public class Member {
    private long id;
    @NotBlank
    private String name;
    @NotBlank
    @Pattern(regexp = "^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+.[A-Za-z]{2,6}$", message = "ì´ë©”ì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.")
    private String email;
    @NotBlank
    @Pattern(regexp = "(?=.*[0-9])(?=.*[a-zA-Z])(?=.*\\W)(?=\\S+$).{8,16}")
    private String password;
    private int money;

    public Member() {
    }

    public Member(String name, String email, String password) {
        this.name = name;
        this.email = email;
        this.password = password;
    }
}
```

- member ê°ì²´
  - long id : dbì—ì„œ ìë™ìœ¼ë¡œ 1ì”© ì¦ê°€í•œë‹¤.
  - name : ê³µë°±ì„ í—ˆìš©í•˜ì§€ ì•ŠëŠ” Notblank ê²€ì¦ì„ í•œë‹¤.
  - email : ê³µë°±ì„ í—ˆìš©í•˜ì§€ ì•Šê³ , ì´ë©”ì¼ í˜•ì‹ì¸ì§€ ê²€ì¦ì„ í•œë‹¤.
  - password : ê³µë°±ì„ í—ˆìš©í•˜ì§€ ì•Šê³ , íŠ¹ìˆ˜ë¬¸ì,ì˜ë¬¸ì,ìˆ«ìì˜ í˜¼í•©í˜•íƒœì¸ì§€ ê²€ì¦ì„í•œë‹¤.
  - money : íšŒì›ê°€ì…í•  ì‹œ ê¸°ë³¸ 5000ì˜ ê°’ì´ ë“¤ì–´ê°„ë‹¤.

```java
    public void save(Member member){
        String sql = "insert into member(member_name,member_email,member_password) values (?,?,?)";

        Connection con = null;
        PreparedStatement pstmt = null;
        try{
            con = getConnection();
            pstmt = con.prepareStatement(sql);
            pstmt.setString(1,member.getName());
            pstmt.setString(2,member.getEmail());
            pstmt.setString(3,member.getPassword());
            pstmt.executeUpdate();
        } catch (SQLException e) {
            throw new RuntimeException(e);
        } finally {
            close(con,pstmt,null);
        }
    }
```
- domain/member/memberRepository.java ì˜ save ë©”ì„œë“œ
  - member ê°ì²´ë¥¼ ë°›ìœ¼ë©´ ë©¤ë²„ê°ì²´ì˜ ì´ë¦„, ì´ë©”ì¼, íŒ¨ìŠ¤ì›Œë“œë¥¼ insertì¿¼ë¦¬ë¡œ ë‚ ë¦°ë‹¤.


### íšŒì› ìˆ˜ì •

#### 1. [html(thymeleaf)](https://github.com/gudals-kim/web_vulnerability/blob/delevlop/web/src/main/resources/templates/member/memberEdit.html)

<img src="https://github.com/gudals-kim/web_vulnerability/blob/delevlop/web/docs/img/memberEdit.png">

- íšŒì› ì •ë³´ë¥¼ ìˆ˜ì •í•˜ëŠ” í™”ë©´ì´ë‹¤.
- url : /member/{memberId}/edit

#### 2. ì»¨íŠ¸ë¡¤ëŸ¬ ë¶€ë¶„ (controller)
```java
    @GetMapping("/{memberId}/edit")
    public String memberEdit(@PathVariable Long memberId,
                             Model model){
        Member member = memberRepository.find(memberId);
        AddMemberForm addMember = memberService.editMember(memberId, member);
        model.addAttribute("member",addMember);
        return "member/memberEdit";
    }



    @PostMapping("/{memberId}/edit")
    public String memberEdit(@PathVariable Long memberId,
            @Valid @ModelAttribute("member") AddMemberForm addMember, BindingResult bindingResult
    ){
        addMember.setId(memberId);
        if (bindingResult.hasErrors()){
            return "member/memberEdit";
        }
        if (memberService.isPasswordEqual(addMember)){
            memberService.changeMember(addMember, memberId);
            return "redirect:/member/{memberId}";
        }
        bindingResult.rejectValue("confirmPassword","confirmPassword","ë¹„ë°€ë²ˆí˜¸ê°€ ê°™ì§€ ì•ŠìŠµë‹ˆë‹¤.");
        return "member/memberEdit";
    }
```

- GET : /member/{memberId}/edit
  - memberEdit 
    - @PathVariable ì„ í™œìš©í•˜ì—¬ urlì˜ memberIdë¥¼ ë°›ì•„ì„œ í˜„ì¬ íšŒì›ì˜ íšŒì› ì •ë³´ë¥¼ dbì—ì„œ ì°¾ì•„ member ê°ì²´ë¡œ ë°˜í™˜ë°›ëŠ”ë‹¤.
    - ì°¾ì€ member ê°ì²´ë¥¼ AddMemberFormì˜ ê°ì²´ë¡œ ë°”ê¾¸ì–´ modelì— ì €ì¥í•œë‹¤.
    - member/memberEdit.htmlì„ ë¦¬í„´í•œë‹¤.
- POST : /member/{memberId}/edit
  - memberEdit
    - ì‚¬ìš©ìê°€ í¼ì—ì„œ ì…ë ¥í•œ ê°’ì„ addMemberFormì˜ ê°ì²´ë¡œ ë°›ì•„ì™”ë‹¤.
    - addMemberì—ëŠ” idê°€ ì—†ìŒìœ¼ë¡œ @PathVariableë¡œ ì‚¬ìš©ìì˜ idë¥¼ ì„¸íŒ…í•´ì¤€ë‹¤.
    - bindingresultì— ì˜¤ë¥˜ê°€ ìˆì„ì‹œ memeber/memberEditì„ ë¦¬í„´í•œë‹¤.
    - ì„œë¹„ìŠ¤ ë¡œì§ì„ ìˆ˜í–‰ì‹œ ture ì¼ë•Œ, /member/{memberId}ë¥¼ ë¦¬ë‹¤ì´ë ‰íŠ¸í•œë‹¤.


#### 3. ì„œë¹„ìŠ¤ ë¶€ë¶„(service)
```java
    public boolean isPasswordEqual(AddMemberForm addMemberForm) {
        return addMemberForm.getPassword().equals(addMemberForm.getConfirmPassword());
    }
    public boolean isPasswordEqual(PasswordSetForm passwordSetForm) {
        return passwordSetForm.getPassword().equals(passwordSetForm.getConfirmPassword());
    }
```

- service/MemberService.java
  - íŒ¨ìŠ¤ì›Œë“œê°€ ê°™ì€ì§€ ê²€ì¦í•œë‹¤.

#### 4. DBInterface(jdbc)
```java
    public Member find(Long memberId){
        String sql = "select * from member where member_Id = ?";

        Connection con = null;
        PreparedStatement pstmt = null;
        ResultSet rs = null;

        try {
            con = getConnection();
            pstmt = con.prepareStatement(sql);
            pstmt.setLong(1,memberId);
            rs = pstmt.executeQuery();
            if (rs.next()){
                Member member = new Member(
                        rs.getString("member_name"),
                        rs.getString("member_email"),
                        rs.getString("member_password"));
                member.setId(rs.getLong("member_id"));
                member.setMoney(rs.getInt("member_money"));
                return member;
            }else {
                throw new NoSuchFieldException("member not found memberId = "+ memberId);
            }
        } catch (SQLException | NoSuchFieldException e) {
            if (e instanceof NoSuchFieldException){
                return null;
            }
            throw new RuntimeException(e);
        } finally {
            close(con,pstmt,rs);
        }
    }
    
    public void update(Member member){
        String sql = "update member set (member_name, member_email, member_password) = (?,?,?) where member_id=?";

        Connection con = null;
        PreparedStatement pstmt = null;
        try {
            con = getConnection();
            pstmt = con.prepareStatement(sql);
            pstmt.setString(1,member.getName());
            pstmt.setString(2,member.getEmail());
            pstmt.setString(3,member.getPassword());
            pstmt.setLong(4,member.getId());

            pstmt.executeUpdate();
        } catch (SQLException e) {
            throw new RuntimeException(e);
        } finally {
            close(con,pstmt,null);
        }
    }
```
- domain/member/memberRepository.java ì˜ find(Long **memberId**) ë©”ì„œë“œ
  - memberIdë¥¼ ë°›ìœ¼ë©´ "select * from member where member_Id = **memberId**" ì¿¼ë¦¬ë¥¼ ë‚ ë ¤ì„œ ë©¤ë²„ê°ì²´ë¡œ ê°€ì ¸ì˜¨ë‹¤.
- domain/member/memberRepository.java ì˜ update(Member member) ë©”ì„œë“œ
  - member ê°ì²´ë¥¼ ë°›ìœ¼ë©´ ë©¤ë²„ê°ì²´ì˜ ì´ë¦„, ì´ë©”ì¼, íŒ¨ìŠ¤ì›Œë“œë¥¼ update ì¿¼ë¦¬ë¡œ ë‚ ë¦°ë‹¤.


### íšŒì›ì¡°íšŒ

#### 1. [html(thymeleaf)](https://github.com/gudals-kim/web_vulnerability/blob/delevlop/web/src/main/resources/templates/member/member.html)

<img src="https://github.com/gudals-kim/web_vulnerability/blob/delevlop/web/docs/img/member.png">

- ë©¤ë²„ ì •ë³´ë¥¼ ì¡°íšŒí• ë•Œ ë³´ì´ëŠ” í˜ì´ì§€
- URL : /member/{memberId}

#### 2. ì»¨íŠ¸ë¡¤ëŸ¬ ë¶€ë¶„ (controller)
```java
    @GetMapping("/{memberId}")
    public String member(@PathVariable Long memberId, Model model){
        Member findMember = memberRepository.find(memberId);
        model.addAttribute("member",findMember);
        return "member/member";
    }
```
- GET : /member/{memberId}
  - memberId ë¡œ memberRepositoryì—ì„œ ë©¤ë²„ë¥¼ ì°¾ì•„ì„œ ëª¨ë¸ì— ì €ì¥í•œë‹¤.
  - member/member.htmlì„ ë¦¬í„´í•œë‹¤.

#### 3. DBInterface(jdbc)
```java
    public Member find(String memberEmail){
        String sql = "select * from member where member_email = ?";

        Connection con = null;
        PreparedStatement pstmt = null;
        ResultSet rs = null;

        try {
            con = getConnection();
            pstmt = con.prepareStatement(sql);
            pstmt.setString(1,memberEmail);
            rs = pstmt.executeQuery();
            if (rs.next()){
                Member member = new Member(
                        rs.getString("member_name"),
                        rs.getString("member_email"),
                        rs.getString("member_password"));
                member.setId(rs.getLong("member_id"));
                member.setMoney(rs.getInt("member_money"));
                return member;
            }else {
                throw new NoSuchFieldException("member not found memberEmail = "+ memberEmail);
            }
        } catch (SQLException | NoSuchFieldException e) {
            if (e instanceof NoSuchFieldException){
                return null;
            }
            throw new RuntimeException(e);
        } finally {
            close(con,pstmt,rs);
        }

    }

    public Member find(Long memberId){
        String sql = "select * from member where member_Id = ?";

        Connection con = null;
        PreparedStatement pstmt = null;
        ResultSet rs = null;

        try {
            con = getConnection();
            pstmt = con.prepareStatement(sql);
            pstmt.setLong(1,memberId);
            rs = pstmt.executeQuery();
            if (rs.next()){
                Member member = new Member(
                        rs.getString("member_name"),
                        rs.getString("member_email"),
                        rs.getString("member_password"));
                member.setId(rs.getLong("member_id"));
                member.setMoney(rs.getInt("member_money"));
                return member;
            }else {
                throw new NoSuchFieldException("member not found memberId = "+ memberId);
            }
        } catch (SQLException | NoSuchFieldException e) {
            if (e instanceof NoSuchFieldException){
                return null;
            }
            throw new RuntimeException(e);
        } finally {
            close(con,pstmt,rs);
        }
    }
```
- find(memberId) : memberIdë¡œ RDBì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ Member ê°ì²´ë¡œ ê°€ì ¸ì˜¨ë‹¤.
- find(memberEmail) : memberEmailì´ ì¤‘ë³µê°€ì…ì´ ì•ˆë˜ê¸° ë•Œë¬¸ì— Emailì´ keyê°€ ë  ìˆ˜ ìˆë‹¤. ì´í›„ ì½”ë“œëŠ” ìƒë™



## 2. ë¡œê·¸ì¸ ê¸°ëŠ¥

### ì„¸ì…˜/ì¿ í‚¤, ìŠ¤í”„ë§ ì¸í„°ì…‰í„°

#### ì„¸ì…˜/ì¿ í‚¤
- ì„œë¸”ë¦¿ requestì˜ Sessionì„ í™œìš©í•œë‹¤. 

#### ì¸í„°ì…‰í„° 

```java
@Slf4j
public class LoginCheckInterceptor implements HandlerInterceptor {
    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {

        String requestURI = request.getRequestURI();
        log.info("ì¸ì¦ ì²´í¬ ì¸í„°ì…‰í„° ì‹¤í–‰ {}", requestURI);

        HttpSession session = request.getSession();
        if (session==null || session.getAttribute(LOGIN_MEMBER)==null){
            log.info("ë¯¸ì¸ì¦ ì‚¬ìš©ì ìš”ì²­");
            response.sendRedirect("/login?redirectURL="+requestURI);
            return false;
        }
        return true;
    }
}
```
- ìŠ¤í”„ë§ì˜ ì¸í„°ì…‰í„°ë¥¼ í™œìš©í•˜ì—¬ ë¡œê·¸ì¸ì•ˆë˜ì–´ ìˆì„ì‹œ(ì„¸ì…˜ì— ì •ë³´ê°€ ì—†ì„ì‹œ) homeìœ¼ë¡œ ë Œë”í•˜ëŠ” ì¸í„°ì…‰í„°ë¥¼ êµ¬í˜„í–ˆë‹¤.

#### webConfig : annotation Resolvers, addInterceptorsë¥¼ ë§Œë“¤ì–´ì¤€ë‹¤.
```java
@Configuration
public class WebConfig implements WebMvcConfigurer {

    @Override
    public void addArgumentResolvers(List<HandlerMethodArgumentResolver> resolvers) {
        resolvers.add(new LoginMemberArgumentResolver());
    }

    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(new LogInterceptor())
                .order(1)
                .addPathPatterns("/**")
                .excludePathPatterns("/css/**","/*.ico","/error");
        registry.addInterceptor(new LoginCheckInterceptor())
                .order(2)
                .addPathPatterns("/**")
                .excludePathPatterns("/css/**","/*.ico","/members/add","/login","/logout","/error","/*","/member/find/**");
    }
}
```
- ë‚´ê°€ ë§Œë“  ì–´ë…¸í…Œì´ì…˜ê³¼ ì¸í„°ì…‰í„°ë¥¼ ìŠ¤í”„ë§ ì»¨í…ìŠ¤íŠ¸ì— ì„¤ì •í•´ì¤€ë‹¤. 

#### @Login annotaion : ì»¤ìŠ¤í…€ ë¡œê·¸ì¸ annotaion

```java
@Target(ElementType.PARAMETER)
@Retention(RetentionPolicy.RUNTIME)
public @interface Login {}
```
type ì„¤ì • ë° retention ì„¤ì •ì„ í•´ì£¼ì—ˆë‹¤.

```java
@Slf4j
public class LoginMemberArgumentResolver implements HandlerMethodArgumentResolver {
    @Override
    public boolean supportsParameter(MethodParameter parameter) {
        log.info("supportsParameter ì‹¤í–‰");
        boolean hasLoginAnnotation = parameter.hasParameterAnnotation(Login.class);
        boolean hasMemberType = Member.class.isAssignableFrom(parameter.getParameterType());
        log.debug("hasLoginAnnotation={}",hasLoginAnnotation);
        log.debug("hasMemberType={}",hasMemberType);
        return hasMemberType && hasLoginAnnotation;
    }

    @Override
    public Object resolveArgument(MethodParameter parameter, ModelAndViewContainer mavContainer, NativeWebRequest webRequest, WebDataBinderFactory binderFactory) throws Exception {
        log.info("resolveArgument ì‹¤í–‰");
        HttpServletRequest request = (HttpServletRequest) webRequest.getNativeRequest();
        log.debug("webRequest.getNativeRequest()={}",webRequest.getNativeRequest());
        HttpSession session = request.getSession(false);
        log.debug("session={}",session);
        if (session==null){
            return null;
        }
        log.debug("session.getAttribute(LOGIN_MEMBER)={}",session.getAttribute(LOGIN_MEMBER));
        return session.getAttribute(LOGIN_MEMBER);
    }
}
```
- íŒŒë¼ë¯¸í„°ê°€ member ë° Login ì–´ë…¸í…Œì´ì…˜ í´ë˜ìŠ¤ ì¼ë•Œ ì‹¤í–‰ëœë‹¤.
- requestì—ì„œ ì„¸ì…˜ì •ë³´ë¥¼ ê°€ì ¸ì™”ì„ì‹œ ì„¸ì…˜ì´ ì—†ë‹¤ë©´ nullì„ ë¦¬í„´í•˜ê³  ìˆì„ì‹œ ì„¸ì…˜ì •ë³´ë¥¼ ë¦¬í„´í•œë‹¤.

### ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ


#### 1. [html(thymeleaf)](https://github.com/gudals-kim/web_vulnerability/blob/delevlop/web/src/main/resources/templates/member/memberForm.html)

<img src="https://github.com/gudals-kim/web_vulnerability/blob/delevlop/web/docs/img/loginForm.png">


#### 2. ì»¨íŠ¸ë¡¤ëŸ¬ ë¶€ë¶„ (controller)
```java
@Controller
@RequiredArgsConstructor
@Slf4j
public class LoginController {

    private final LoginService loginService;

    @GetMapping("/login")
    public String loginForm(@ModelAttribute("loginForm") LoginForm loginForm) {
        return "login/loginForm";
    }
    @PostMapping("/login")
    public String login(@Valid @ModelAttribute("loginForm") LoginForm loginForm,
                        BindingResult bindingResult,
                        @RequestParam(defaultValue = "/") String redirectURL,
                        HttpServletRequest request){
        if (bindingResult.hasErrors()){
            return "login/loginForm";
        }

        Member loginMember = loginService.login(loginForm.getEmail(), loginForm.getPassword());
        log.debug("loginMember={}",loginMember);
        if (loginMember == null){
            bindingResult.reject("loginFail","ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ë§ì§€ ì•ŠìŠµë‹ˆë‹¤.");
            return "login/loginForm";
        }
        HttpSession session = request.getSession();
        session.setAttribute(LOGIN_MEMBER,loginMember);

        return "redirect:"+redirectURL;
    }
    
    @PostMapping("/logout")
    public String logout(HttpServletRequest request) {
        HttpSession session = request.getSession(false);
        if (session!=null){
            session.invalidate();
        }
        return "redirect:/";
    }
}
```
- GET : /login
  - LoginFormì„ modelAttributeë¡œ ë‹´ì•„ì„œ login/loginForm.htmlì„ ë¦¬í„´í•œë‹¤.
- POST : /login
  - bindingResultì— ì—ëŸ¬ê°€ ìˆìœ¼ë©´ login/loginForm (<- ì˜¤ë¥˜ì •ë³´ê°€ í‘œì‹œëœë‹¤)ì„ ë°”ë¡œ ë¦¬í„´í•œë‹¤.
  - loginService.loginì„ ìˆ˜í–‰í›„ loginMember ê°€ nullì¼ì‹œ bindingResultì— ì˜¤ë¥˜ë¥¼ ë‹´ê³  login/loginFormì„ ë¦¬í„´í•œë‹¤.
  - ë¡œê·¸ì¸ ì„œë¹„ìŠ¤ ì„±ê³µì‹œ ì„¸ì…˜ì— ë‹´ê³  ê¸°ì¡´ì— ì ‘ê·¼í•˜ë ¤ í–ˆë˜ URLì„ ë¦¬ë‹¤ì´ë ‰íŠ¸ í•´ì¤€ë‹¤.
- POST : /logout
  - í˜„ì¬ ì¡´ì¬í•˜ëŠ” ì„¸ì…˜ì„ ì°¾ì•„ì„œ ì„¸ì…˜ì„ ì¢…ë£Œì‹œí‚¨ë‹¤. ì´í›„ í™ˆí™”ë©´ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ í•œë‹¤.
  
#### 3. ì„œë¹„ìŠ¤ ë¶€ë¶„(service)
```java
@Slf4j
@Service
public class LoginService {
    private final MemberRepository memberRepository;
    public LoginService(MemberRepository memberRepository){
        this.memberRepository = memberRepository;
    }
    public Member login(String loginEmail, String password){
        Member member = memberRepository.find(loginEmail);
        if (member!=null&&member.getPassword().equals(password)){
            log.debug("[member={}][input password={}]",member,password);
            return member;
        }
        return null;
    }
}
```
- login ë©”ì„œë“œ
  - email ê³¼ íŒ¨ìŠ¤ì›Œë“œë¥¼ ì…ë ¥ ë°›ëŠ”ë‹¤.
  - emailë¡œ emailì— í•´ë‹¹í•˜ëŠ” ë©¤ë²„ì˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¨ë‹¤.
  - í•´ë‹¹ ë©¤ë²„ì˜ íŒ¨ìŠ¤ì›Œë“œì™€ ì…ë ¥í•œ íŒ¨ìŠ¤ì›Œë“œê°€ ê°™ì„ ì‹œ ì°¾ì€ ë©¤ë²„ë¥¼ ë°˜í™˜í•œë‹¤.
  - ê°™ì§€ ì•Šì„ì‹œ nullì„ ë¦¬í„´í•œë‹¤.











#### 1. [html(thymeleaf)](https://github.com/gudals-kim/web_vulnerability/blob/delevlop/web/src/main/resources/templates/member/memberForm.html)

<img src="https://github.com/gudals-kim/web_vulnerability/blob/delevlop/web/docs/img/memberAdd.png">


#### 2. ì»¨íŠ¸ë¡¤ëŸ¬ ë¶€ë¶„ (controller)
```java

```

#### 3. ì„œë¹„ìŠ¤ ë¶€ë¶„(service)
```java

```

#### 4. DBInterface(jdbc)
```java


```